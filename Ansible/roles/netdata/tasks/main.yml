---
- name: Installation of curl
  ignore_errors: yes
  apt:
      pkg: curl
      state: present
      update_cache: true

- name: Check if Netdata is installed
  stat:
      path: /etc/netdata
  register: netdata

- name: Cloning Netdata installation script
  get_url:
        url: https://my-netdata.io/kickstart.sh
        dest: /home/arsciand/
        mode: 0755
  when: netdata.stat.exists == false

- name: Executing kickstart.sh (Netdata installation script)
  command: sh kickstart.sh --dont-wait
  args:
      chdir: /home/arsciand/
  register: output
  when: netdata.stat.exists == false

- debug:
      var: output
  when: netdata.stat.exists == false

- name: Modifying /etc/netdata/netdata.conf memory usage
  command: sed -i '21/# history = 3996/history = 3600/' /etc/netdata/netdata.conf
  backup: yes
  notify:
        - Restart Netdata

- name: Adding optimisation of Netdata in /etc/rc.local
  copy:
      src: rc.local
      dest: /etc/
      owner: root
      group: root
      mode: a+x

